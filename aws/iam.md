# aws の IAM に関するメモ。

## やろうとしたこと

RDS の インスタンスの起動、停止のみを行えるユーザーを作りたかった。実現出来たので下記にメモする。

マネジメントコンソールの IAM 内のアクセス管理の下に並ぶ項目を設定していく。  

現在、グループ、ユーザー、ロール、ポリシーと並んでいる。
まず、今回はグループには権限を付与せず RDS 用として名前をつけて作成。新規ユーザーを加える。  

最初、RDSFullAccess のポリシーをアタッチして作成。  
この状態でユーザーにインラインポリシー（DBインスタンスの起動、停止のみ許可）を作成してアタッチ。
その結果、RDSFullAccess の方が優先になったらしく、インラインポリシー外の操作も可能になってしまった。

## ユーザーに対してアクセス権限の付与

できる操作を制限するため、グループには何も設定を行わず、ユーザーに対して直接アクセス権限を追加する。  
マネジメントコンソール  
-> アクセス管理のサブ項目中のユーザー  
-> ユーザーを選択  
-> インラインポリシーの追加

今の所、json　を直接編集はハードルが高すぎなため、自動生成してもらう。  
今回はサービスで RDS を選択。
許可するアクションを選択（選択していないアクションにはアクセスできないみたい）。

今回許可したアクションは以下。

```
"rds:DescribeDBInstances",
"rds:StopDBInstance",
"rds:StartDBInstance"
```

start,stop に関してはそのままだが、DescribeDBInstances は、マネジメントコンソールからDBインスタンスを確認するのに必要だった。これを許可しない場合DBインスタンスが表示されない？  

CLI の操作でインスタンス名を指定してアクションを実行する場合はなくても可能なため、 多分 DB の一覧取得にこれを許可する必要があるのかも。

リソースを指定（ここはよくわからなかったけど、dbのインスタンス名とかを指定する？）。  
リクエスト条件は未指定。  

以上でポリシーの作成を完了。これを付与で制限をつけたユーザーを実現。

この後、作成したユーザーのマネジメントコンソールにアクセスした所警告が出る。DBクラスター（DBインスタンスのグループみたいなもの？）へのアクセスが許可されていないとの警告。少し気持ち悪いがアクセス制限は意図通りなのでOKか？