# Linux bash コマンドに関するメモ

## grep

### 基本書式  
`grep [オプション] [対象文字列]`

検索文字列に関しては、特に "" で囲ったりする必要はない(但し空白が入る場合は別だと思われる。)

### 使用例
`grep 検索文字列 test.txt`

### OR 検索
`grep -e 検索文字列1 -e 検索文字列2 test.txt`

### フォルダ以下のファイルを検索
`grep -r 検索文字列 対象フォルダ`

## 使いそうなオプション

-i 大文字と小文字を無視  
-o 一致した文字列のみを表示（無指定はマッチした行全体を表示）  
-v 一致しなかったものを表示する。  
-n 一致した文字列の行番号を一緒に表示する。

## 便利コマンド

### 検索した文字列に番号を振って出力する。
`grep 検索文字列 test.txt | nl`

### 上記+行番号+マッチした回数(0詰め3桁)
`grep -n 検索文字列 test.txt | nl -w3 -nrz`

### 行末にセミコロンがついてない箇所を検索（ディレクトリ）
`grep -ve \;.$ -ve {.$ -ve }.$ -ve ^.$ -ve // -ve "\*\*" -ve "^\s*\*" -r directoryName | less`

余談:行末にセミコロンをつけ忘れている箇所を検索しようとしたときに、行末の一字と行末の間に何らかの文字が入っているらしい。  
検索したファイルは .as で、コードフォーマッターを使用していたけど何か挿入されてる？

## ls

### 使いそうなオプション

-1 ファイルを１行１つの表示にする。  
-a ドットファイルも含めてファイルを表示する。

--ignore=pattern パターンにマッチするファイルを非表示にする。xargs とかの組み合わせが強力。  
使用例 以下はテキストファイルを非表示にする。

`ls --ignore=*.txt`


## cat

ファイルを表示するコマンド。複数指定可。以下使用例。

`cat a.txt b.txt c.txt`

ファイルの中身を確認するだけなら less コマンドの方が便利。  
主にファイルの中身を標準出力に出して、ファイルやクリップボードにリダイレクトする際に使用する。  
複数のテキストファイルを一つに連結したりもできる。知ってるとちょっとした作業が楽になるコマンド。

以下のコマンドは a.txt の内容を dest.txt に追記する。余談だが、上書きの場合は '>' を使う。

`cat a.txt >> dest.txt`

### 使いそうなオプション
-n 行番号をつける。  
-b 同じく行番号をつけるが、空白をカウントしない。  
-s 連続した空行を１行にまとめて表示。  

## xargs

標準出力を後に続くコマンドの引数にわたすコマンド。知ってると便利。

`ls | xargs cat`

ls によってファイル一覧が出力され、出力されたファイル名が cat コマンドの引数として渡される。  
上記コマンドの内容をファイルにリダイレクトすれば、ファイルを結合したりもできる。

## patch

ファイルの変更を出力して、別のディレクトリに適用するコマンド。自分は git とセットで使用。  
まずは、 git diff コマンドの出力をファイルにリダイレクトする。拡張子は別に無くても可。わかれば良い。

	$ git diff > diff.patch
	
diff.patch が変更を保存したファイルなるので、それを変更を適用したいディレクトリに置く。

	$ patch -p1 < diff.patch
	
パッチコマンドに diff.patch を入力すれば適用できる。p1 オプションに関しては、diff.patch に記述されている

	--- dir0/dir1/dir2
	
のパスの部分を指定した数値分無視するオプションらしい。  
つまり p1 で指定した場合は 上記で言えば、dir0 が無視される。  
git diff の場合はパスの前に `a/ b/` といったディレクトリが入るため、1 を指定していると理解。  
これが 0 だと、git を使用した今回のケースでは動作しなかった。

### エラーが出た場合

適用の際にエラーが出たので書き留める。出たエラーが以下。

	patching file fileName
	Hunk #1 FAILED at 01 (different line nedings).

パッチの適用失敗。リポジトリに `.orig .rej` ファイルが生成された。  
今回のケースでは、適用先とパッチファイルの改行コードの違いが問題だったらしいが、改行コードの修正では問題を解決できず。

	$ patch -p1 --binary < diff.patch
	
で解決。 `--binary` は、ファイルをバイナリモードで読み書きすることのこと。  
バイナリファイルで読み書きは理解できるけど、何故これで改行コードの問題が解決すのかは不明。